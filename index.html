<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>PuntoAlmacen ‚Äì Tienda por WhatsApp | Compr√° f√°cil desde tu casa</title>
  <meta name="description" content="Tienda de almac√©n, indumentaria y electrodom√©sticos. Hac√© tu pedido por WhatsApp y te lo llevamos a domicilio.">
  <meta name="keywords" content="almac√©n, tienda, electrodom√©sticos, indumentaria, compras, WhatsApp, delivery">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- SDK de Parse para Back4app -->
  <script src="https://unpkg.com/parse/dist/parse.min.js"></script>
  
  <style>
    /* ESTILOS GENERALES */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f8f9fa;
      color: #333;
      line-height: 1.6;
    }

    /* HEADER MEJORADO CON LOGO */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 5%;
      background: white;
      box-shadow: 0 2px 15px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo {
      height: 50px;
      width: auto;
      transition: transform 0.3s ease;
    }

    .logo:hover {
      transform: scale(1.05);
    }

    .logo-text {
      font-size: 1.5em;
      font-weight: bold;
      color: #25D366;
    }

    .logo-subtitle {
      font-size: 0.9em;
      color: #666;
      margin-top: -5px;
    }

    .btn-wsp-float {
      background: #25D366;
      padding: 12px 20px;
      border-radius: 25px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: white;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
    }

    .btn-wsp-float:hover {
      background: #128C7E;
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(37, 211, 102, 0.4);
    }

    .btn-wsp-float img {
      width: 24px;
      height: 24px;
    }

    /* HERO SECTION */
    .hero {
      position: relative;
      margin: 20px 5%;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }

    .hero img {
      width: 100%;
      height: 300px;
      object-fit: cover;
      display: block;
    }

    .btn-oferta {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background: #ff4444;
      color: white;
      padding: 12px 25px;
      border-radius: 25px;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .btn-oferta:hover {
      background: #cc0000;
      transform: scale(1.05);
    }

    /* BANNER RIFAS */
    .banner-rifas {
      margin: 30px 5%;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      position: relative;
    }

    .banner-rifas:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .banner-rifas a {
      display: block;
      text-decoration: none;
    }

    .banner-rifas img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
    }

    .banner-rifas-content {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.8));
      color: white;
      padding: 20px;
      text-align: center;
    }

    .banner-rifas h3 {
      font-size: 1.5em;
      margin-bottom: 5px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }

    .banner-rifas p {
      font-size: 1em;
      opacity: 0.9;
      margin-bottom: 10px;
    }

    .btn-rifas {
      background: #FF6B35;
      color: white;
      padding: 10px 20px;
      border-radius: 25px;
      text-decoration: none;
      font-weight: bold;
      display: inline-block;
      transition: all 0.3s ease;
    }

    .btn-rifas:hover {
      background: #E55A2B;
      transform: scale(1.05);
    }

    /* MAIN CONTENT */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .busqueda {
      width: 100%;
      padding: 15px;
      margin: 20px 0;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }

    .busqueda:focus {
      outline: none;
      border-color: #25D366;
    }

    .filtros {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 25px 0;
      flex-wrap: wrap;
    }

    .btn-filtro {
      padding: 10px 20px;
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .btn-filtro.active {
      background: #25D366;
      color: white;
      border-color: #25D366;
    }

    .btn-filtro:hover:not(.active) {
      background: #e9ecef;
    }

    .titulo-seccion {
      text-align: center;
      margin: 40px 0 20px 0;
      color: #2c3e50;
      font-size: 2em;
      position: relative;
    }

    .titulo-seccion::after {
      content: '';
      display: block;
      width: 60px;
      height: 4px;
      background: #25D366;
      margin: 10px auto;
      border-radius: 2px;
    }

    .grilla {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .producto-card {
      background: white;
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
      border: 1px solid #f1f3f4;
    }

    .producto-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.15);
    }

    .producto-imagen {
      position: relative;
      margin-bottom: 15px;
    }

    .producto-imagen img {
      width: 100%;
      height: 250px;
      object-fit: cover;
      border-radius: 10px;
    }

    .badge-oferta {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #ff4444;
      color: white;
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 0.8em;
      font-weight: bold;
    }

    .badge-sin-stock {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #6c757d;
      color: white;
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 0.8em;
      font-weight: bold;
    }

    .producto-card h3 {
      margin: 15px 0 10px 0;
      color: #2c3e50;
      font-size: 1.2em;
    }

    .precio {
      font-weight: bold;
      color: #25D366;
      font-size: 1.4em;
      margin: 15px 0;
    }

    .btn-agregar {
      background: #25D366;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: bold;
      width: 100%;
    }

    .btn-agregar:hover {
      background: #128C7E;
      transform: translateY(-2px);
    }

    .btn-agregar:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: none;
    }

    /* BOTONES FLOTANTES */
    .btn-admin {
      position: fixed;
      bottom: 150px;
      right: 25px;
      background: #6c757d;
      color: white;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      cursor: pointer;
      z-index: 99;
      transition: all 0.3s ease;
      border: none;
      font-size: 24px;
    }

    .btn-admin:hover {
      transform: scale(1.1);
      background: #5a6268;
    }

    .carrito-flotante {
      position: fixed;
      bottom: 70px;
      right: 25px;
      background: #25D366;
      color: white;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      cursor: pointer;
      z-index: 99;
      transition: all 0.3s ease;
    }

    .carrito-flotante:hover {
      transform: scale(1.1);
    }

    .contador-carrito {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ff4444;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }

    /* MODAL CARRITO */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal-contenido {
      background: white;
      padding: 30px;
      border-radius: 15px;
      max-width: 90%;
      max-height: 80%;
      overflow-y: auto;
      width: 500px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    }

    .modal-cerrar {
      float: right;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }

    .modal-cerrar:hover {
      color: #333;
    }

    .producto-carrito {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid #eee;
    }

    .producto-info {
      flex-grow: 1;
    }

    .producto-cantidad {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .btn-cantidad {
      background: #f8f9fa;
      border: 1px solid #ddd;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-cantidad:hover {
      background: #e9ecef;
    }

    .btn-enviar-pedido {
      background: #25D366;
      color: white;
      border: none;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      width: 100%;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .btn-enviar-pedido:hover {
      background: #128C7E;
      transform: translateY(-2px);
    }

    /* FOOTER */
    footer {
      background: #2c3e50;
      color: white;
      text-align: center;
      padding: 30px 20px;
      margin-top: 50px;
    }

    footer a {
      color: #25D366;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* NOTIFICACIONES */
    .notificacion {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #25D366;
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      z-index: 1000;
      animation: fadeInOut 3s ease-in-out;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    @keyframes fadeInOut {
      0% { opacity: 0; transform: translateY(-20px); }
      20% { opacity: 1; transform: translateY(0); }
      80% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-20px); }
    }

    /* LOADING Y ESTADOS */
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
      font-size: 1.1em;
    }

    .sin-productos {
      text-align: center;
      padding: 40px;
      color: #666;
      grid-column: 1 / -1;
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .header {
        padding: 10px 5%;
        flex-direction: column;
        gap: 15px;
      }

      .logo {
        height: 40px;
      }

      .hero img {
        height: 200px;
      }

      .banner-rifas img {
        height: 150px;
      }

      .banner-rifas-content {
        padding: 15px;
      }

      .banner-rifas h3 {
        font-size: 1.2em;
      }

      .banner-rifas p {
        font-size: 0.9em;
      }

      .grilla {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
      }

      .producto-imagen img {
        height: 220px;
      }

      .btn-admin, .carrito-flotante {
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
      }

      .btn-admin {
        bottom: 80px;
      }
    }

    /* üî• NUEVO: Estilos para el sistema de env√≠o */
    .cart-totals {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
    }

    .envio-gratis-msg {
      background: #d1edff;
      border: 1px solid #b3d9ff;
      border-radius: 8px;
      padding: 12px;
      margin: 10px 0;
      text-align: center;
    }

    .envio-gratis-msg .text-success {
      color: #198754;
      font-weight: bold;
    }

    .costo-envio-gratis {
      color: #198754;
      font-weight: bold;
    }

    .costo-envio-normal {
      color: #6c757d;
    }

    /* Modal de datos del cliente */
    .modal-cliente {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1001;
      align-items: center;
      justify-content: center;
    }

    .modal-cliente-contenido {
      background: white;
      padding: 30px;
      border-radius: 15px;
      max-width: 90%;
      width: 400px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #333;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s ease;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #25D366;
    }

    .btn-confirmar {
      background: #25D366;
      color: white;
      border: none;
      padding: 15px;
      border-radius: 10px;
      width: 100%;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .btn-confirmar:hover {
      background: #128C7E;
      transform: translateY(-2px);
    }
  </style>
</head>
<body>

<!-- HEADER CON LOGO -->
<header class="header">
  <div class="logo-container">
    <img src="img/logo.jpg.jpeg" alt="PuntoAlmacen - Tienda por WhatsApp" class="logo">
    <div>
      <div class="logo-text">PuntoAlmacen</div>
      <div class="logo-subtitle">Tienda por WhatsApp</div>
    </div>
  </div>
  
  <a class="btn-wsp-float" id="btn-wsp-header" href="https://wa.me/5493624840349?text=Hola%20PuntoAlmacen,%20quiero%20hacer%20un%20pedido" target="_blank" aria-label="Contactar por WhatsApp">
    <img src="https://img.icons8.com/color/48/whatsapp.png" alt="WhatsApp"/>
    Pedir por WhatsApp
  </a>
</header>

<!-- BANNER OFERTA - Ahora din√°mico desde Back4app -->
<section class="hero" id="banner-oferta-container">
  <img id="banner-oferta-img" src="img/banner-oferta.jpg" alt="Oferta especial - Descuentos hasta 50%">
  <a href="https://wa.me/5493624840349?text=Quiero%20la%20oferta%20del%20d√≠a" class="btn-oferta" id="btn-oferta-link">Quiero mi oferta</a>
</section>

<!-- BANNER RIFAS ONLINE - Ahora din√°mico desde Back4app -->
<section class="banner-rifas" id="banner-rifas-container">
  <a href="https://rifasapponline.netlify.app/" target="_blank" id="banner-rifas-link">
    <img id="banner-rifas-img" src="https://via.placeholder.com/1200x300/FF6B35/ffffff?text=PARTICIPA+EN+NUESTRAS+RIFAS+ONLINE" alt="Participa en nuestras rifas online">
    <div class="banner-rifas-content">
      <h3 id="banner-rifas-titulo">üéâ ¬°Participa en Nuestras Rifas! üéâ</h3>
      <p id="banner-rifas-descripcion">Gana premios incre√≠bles - ¬°Es muy f√°cil participar!</p>
      <span class="btn-rifas">Ver Rifas Online</span>
    </div>
  </a>
</section>

<!-- SECCIONES -->
<main class="container">
  <!-- Barra de b√∫squeda -->
  <input type="text" class="busqueda" placeholder="üîç Buscar productos..." id="busqueda">
  
  <!-- Filtros por categor√≠a -->
  <div class="filtros">
    <button class="btn-filtro active" data-categoria="todos">Todos los productos</button>
    <button class="btn-filtro" data-categoria="almacen">Almac√©n</button>
    <button class="btn-filtro" data-categoria="indumentaria">Indumentaria</button>
    <button class="btn-filtro" data-categoria="electro">Electro</button>
    <button class="btn-filtro" data-categoria="libreria">Librer√≠a</button>
  </div>

  <h2 class="titulo-seccion">Almac√©n</h2>
  <div class="grilla" id="almacen">
    <div class="loading">Cargando productos de almac√©n...</div>
  </div>

  <h2 class="titulo-seccion">Indumentaria</h2>
  <div class="grilla" id="indumentaria">
    <div class="loading">Cargando indumentaria...</div>
  </div>

  <h2 class="titulo-seccion">Electro</h2>
  <div class="grilla" id="electro">
    <div class="loading">Cargando electrodom√©sticos...</div>
  </div>

  <h2 class="titulo-seccion">Librer√≠a</h2>
  <div class="grilla" id="libreria">
    <div class="loading">Cargando productos de librer√≠a...</div>
  </div>

</main>

<!-- Bot√≥n Admin Flotante -->
<button class="btn-admin" id="btnAdmin" title="Panel de Administraci√≥n">‚öôÔ∏è</button>

<!-- Carrito flotante -->
<div class="carrito-flotante" id="carritoBtn">
  <div class="contador-carrito" id="contadorCarrito">0</div>
  <img src="https://img.icons8.com/ios-filled/30/ffffff/shopping-cart.png" alt="Carrito de compras">
</div>

<!-- Modal del carrito -->
<div class="modal" id="modalCarrito">
  <div class="modal-contenido">
    <button class="modal-cerrar" id="cerrarModal">&times;</button>
    <h2>üõí Tu Pedido</h2>
    <div id="listaCarrito">
      <div class="sin-productos">No hay productos en el carrito</div>
    </div>
    
    <!-- üî• NUEVO: Secci√≥n de totales con env√≠o -->
    <div class="cart-totals" id="cartTotals" style="display: none;">
      <div class="d-flex justify-content-between mb-2">
        <span>Subtotal:</span>
        <span id="subtotal-carrito">$0</span>
      </div>
      <div class="d-flex justify-content-between mb-2">
        <span>Env√≠o:</span>
        <span id="costo-envio">$0</span>
      </div>
      <div id="envio-gratis-msg" class="envio-gratis-msg" style="display: none;"></div>
      <div class="d-flex justify-content-between mb-3">
        <strong>Total:</strong>
        <strong id="total-carrito">$0</strong>
      </div>
      
      <button class="btn-enviar-pedido" id="btnEnviarWhatsApp">
        üì± Enviar por WhatsApp
      </button>
      
      <!-- üî• CORRECCI√ìN: Cambiado a funci√≥n global -->
      <button class="btn-enviar-pedido" onclick="vaciarCarrito()" style="background: #dc3545; margin-top: 10px;">
        üóëÔ∏è Vaciar Carrito
      </button>
    </div>
  </div>
</div>

<!-- üî• NUEVO: Modal de datos del cliente -->
<div class="modal-cliente" id="modalInfoCliente">
  <div class="modal-cliente-contenido">
    <button class="modal-cerrar" onclick="cerrarModal('modalInfoCliente')">&times;</button>
    <h2>üë§ Datos de Env√≠o</h2>
    
    <div class="form-group">
      <label for="clienteNombre">Nombre completo *</label>
      <input type="text" id="clienteNombre" placeholder="Tu nombre completo" required>
    </div>
    
    <div class="form-group">
      <label for="clienteTelefono">Tel√©fono *</label>
      <input type="tel" id="clienteTelefono" placeholder="11 1234-5678" required>
    </div>
    
    <div class="form-group">
      <label for="clienteDireccion">Direcci√≥n de env√≠o *</label>
      <textarea id="clienteDireccion" placeholder="Calle, n√∫mero, piso, departamento, ciudad..." required></textarea>
    </div>
    
    <button class="btn-confirmar" onclick="cart.confirmarPedidoConCliente()">
      ‚úÖ Confirmar y Enviar por WhatsApp
    </button>
  </div>
</div>

<!-- FOOTER -->
<footer>
  <p id="footer-info">¬© 2025 PuntoAlmacen ‚Äì Horarios: Lunes a Viernes 9-18 hs</p>
  <p id="footer-contacto">üìç Calle Falsa 123, Ciudad ‚Äì <a href="https://wa.me/5493624840349" id="footer-whatsapp-link">WhatsApp: +54 9 3624 840-349</a></p>
  <p><a href="admin.html" style="color: #ccc; font-size: 12px;">Panel de Administraci√≥n</a></p>
</footer>

<script>
  // =============================================
  // CONFIGURACI√ìN PARSE/BACK4APP
  // =============================================

  // Inicializar Parse con tus credenciales de Back4app
  Parse.initialize("sbbQLlkupAVhCVM3ZYz29GD18w4PeZa9em3brji9", "yLu8MFWZbeBVn1tTIBIUWXECaVLG81531xWul4Tk");
  Parse.serverURL = 'https://parseapi.back4app.com/';

  // =============================================
  // MODELOS DE DATOS MEJORADOS PARA BACK4APP
  // =============================================

  // Clase Producto
  class Producto extends Parse.Object {
    constructor() {
      super('Producto');
    }
    
    static async obtenerTodos() {
      const query = new Parse.Query(Producto);
      query.equalTo('activo', true);
      query.descending('createdAt');
      try {
        return await query.find();
      } catch (error) {
        console.error('Error obteniendo productos:', error);
        return [];
      }
    }
  }

  // Clase Banner para banners din√°micos - MEJORADA
  class Banner extends Parse.Object {
    constructor() {
      super('Banner');
    }
    
    static async obtenerBannersActivos() {
      const query = new Parse.Query(Banner);
      query.equalTo('activo', true);
      query.ascending('orden');
      try {
        return await query.find();
      } catch (error) {
        console.error('Error obteniendo banners:', error);
        return [];
      }
    }
    
    static async obtenerBannerPorTipo(tipo) {
      const query = new Parse.Query(Banner);
      query.equalTo('tipo', tipo);
      query.equalTo('activo', true);
      try {
        const banners = await query.find();
        console.log(`üîç Banners encontrados para ${tipo}:`, banners.length);
        return banners.length > 0 ? banners[0] : null;
      } catch (error) {
        console.error(`‚ùå Error obteniendo banner ${tipo}:`, error);
        return null;
      }
    }
  }

  // Clase Configuracion - MEJORADA
  class Configuracion extends Parse.Object {
    constructor() {
      super('Configuracion');
    }
    
    static async obtener() {
      const query = new Parse.Query(Configuracion);
      try {
        const configs = await query.find();
        return configs.length > 0 ? configs[0] : null;
      } catch (error) {
        console.error('Error obteniendo configuraci√≥n:', error);
        return null;
      }
    }
  }

  // =============================================
  // SISTEMA MEJORADO DE CARRITO CON ENV√çO GRATIS
  // =============================================

  class CartService {
    constructor() {
      this.carrito = this.cargarCarrito();
      this.COSTO_ENVIO_NORMAL = 800;
      this.MINIMO_ENVIO_GRATIS = 10000;
      this.configTienda = {};
      
      this.cargarConfiguracion();
    }

    async cargarConfiguracion() {
      try {
        const config = await Configuracion.obtener();
        if (config) {
          this.configTienda = {
            nombre: config.get('nombreTienda') || 'PuntoAlmacen',
            whatsapp: config.get('whatsapp') || '5493624840349',
            direccion: config.get('direccion') || 'Calle Falsa 123, Ciudad',
            horarios: config.get('horarios') || 'Lunes a Viernes 9-18 hs',
            mensajeWhatsApp: config.get('mensajeWhatsApp') || 'Hola PuntoAlmacen, quiero hacer un pedido'
          };
          
          // Actualizar configuraci√≥n de env√≠o
          const costoEnvio = config.get('costoEnvio');
          const minimoEnvioGratis = config.get('minimoEnvioGratis');
          
          if (costoEnvio) this.COSTO_ENVIO_NORMAL = costoEnvio;
          if (minimoEnvioGratis) this.MINIMO_ENVIO_GRATIS = minimoEnvioGratis;
          
          this.actualizarConfiguracionUI();
        }
      } catch (error) {
        console.error('Error cargando configuraci√≥n:', error);
      }
    }

    cargarCarrito() {
      try {
        return JSON.parse(localStorage.getItem('carritoPuntoAlmacen')) || [];
      } catch (error) {
        console.error('Error cargando carrito:', error);
        return [];
      }
    }

    guardarCarrito() {
      try {
        localStorage.setItem('carritoPuntoAlmacen', JSON.stringify(this.carrito));
      } catch (error) {
        console.error('Error guardando carrito:', error);
      }
    }

    agregarProducto(producto) {
      const existente = this.carrito.find(item => item.id === producto.id);
      
      if (existente) {
        existente.cantidad += 1;
      } else {
        this.carrito.push({
          ...producto,
          cantidad: 1
        });
      }
      
      this.guardarCarrito();
      this.actualizarUI();
      this.mostrarNotificacion(`${producto.nombre} agregado al carrito`);
    }

    eliminarProducto(id) {
      const producto = this.carrito.find(item => item.id === id);
      this.carrito = this.carrito.filter(item => item.id !== id);
      this.guardarCarrito();
      this.actualizarUI();
      
      if (producto) {
        this.mostrarNotificacion(`${producto.nombre} eliminado del carrito`);
      }
    }

    actualizarCantidad(id, nuevaCantidad) {
      const item = this.carrito.find(item => item.id === id);
      if (item) {
        if (nuevaCantidad <= 0) {
          this.eliminarProducto(id);
        } else {
          item.cantidad = nuevaCantidad;
          this.guardarCarrito();
          this.actualizarUI();
        }
      }
    }

    limpiarCarrito() {
      this.carrito = [];
      this.guardarCarrito();
      this.actualizarUI();
      this.mostrarNotificacion('Carrito vaciado');
    }

    getTotal() {
      return this.carrito.reduce((total, item) => total + (item.precio * item.cantidad), 0);
    }

    getCantidadTotal() {
      return this.carrito.reduce((total, item) => total + item.cantidad, 0);
    }

    getCostoEnvio() {
      const subtotal = this.getTotal();
      
      if (subtotal >= this.MINIMO_ENVIO_GRATIS || subtotal === 0) {
        return 0;
      }
      return this.COSTO_ENVIO_NORMAL;
    }

    getTotalConEnvio() {
      return this.getTotal() + this.getCostoEnvio();
    }

    getFaltanteEnvioGratis() {
      const subtotal = this.getTotal();
      if (subtotal >= this.MINIMO_ENVIO_GRATIS) {
        return 0;
      }
      return this.MINIMO_ENVIO_GRATIS - subtotal;
    }

    aplicaEnvioGratis() {
      return this.getTotal() >= this.MINIMO_ENVIO_GRATIS;
    }

    actualizarConfiguracionUI() {
      // Actualizar informaci√≥n de la tienda
      if (this.configTienda.nombre) {
        const logoText = document.querySelector('.logo-text');
        if (logoText) logoText.textContent = this.configTienda.nombre;
      }
      
      if (this.configTienda.horarios) {
        const footerInfo = document.getElementById('footer-info');
        if (footerInfo) {
          footerInfo.textContent = `¬© 2025 ${this.configTienda.nombre} ‚Äì Horarios: ${this.configTienda.horarios}`;
        }
      }
      
      if (this.configTienda.direccion && this.configTienda.whatsapp) {
        const footerContacto = document.getElementById('footer-contacto');
        if (footerContacto) {
          footerContacto.innerHTML = `üìç ${this.configTienda.direccion} ‚Äì <a href="https://wa.me/${this.configTienda.whatsapp}" id="footer-whatsapp-link">WhatsApp: ${this.configTienda.whatsapp}</a>`;
        }
      }
      
      // Actualizar enlaces de WhatsApp
      this.actualizarEnlacesWhatsApp();
    }

    actualizarEnlacesWhatsApp() {
      const whatsapp = this.configTienda.whatsapp || '5493624840349';
      const mensaje = encodeURIComponent(this.configTienda.mensajeWhatsApp || 'Hola PuntoAlmacen, quiero hacer un pedido');
      
      // Actualizar enlace del header
      const btnWspHeader = document.getElementById('btn-wsp-header');
      if (btnWspHeader) {
        btnWspHeader.href = `https://wa.me/${whatsapp}?text=${mensaje}`;
      }
      
      // Actualizar enlace del footer
      const footerWhatsapp = document.getElementById('footer-whatsapp-link');
      if (footerWhatsapp) {
        footerWhatsapp.href = `https://wa.me/${whatsapp}`;
      }
      
      // Actualizar otros enlaces de WhatsApp si existen
      const enlaces = document.querySelectorAll('a[href*="wa.me"]');
      enlaces.forEach(enlace => {
        if (!enlace.id) { // No actualizar los que ya tienen ID espec√≠fico
          enlace.href = enlace.href.replace(/wa\.me\/\d+/, `wa.me/${whatsapp}`);
        }
      });
    }

    actualizarUI() {
      // Actualizar contador del carrito
      const contador = document.getElementById('contadorCarrito');
      if (contador) {
        const total = this.getCantidadTotal();
        contador.textContent = total;
        contador.style.display = total > 0 ? 'flex' : 'none';
      }

      // Actualizar display de env√≠o y totales
      this.actualizarDisplayEnvio();
      
      // Actualizar lista de productos en el modal
      this.actualizarListaCarrito();
    }

    actualizarDisplayEnvio() {
      const envioElement = document.getElementById('costo-envio');
      const envioGratisElement = document.getElementById('envio-gratis-msg');
      const subtotalElement = document.getElementById('subtotal-carrito');
      const totalElement = document.getElementById('total-carrito');
      const cartTotals = document.getElementById('cartTotals');
      
      const subtotal = this.getTotal();
      const envio = this.getCostoEnvio();
      const totalConEnvio = this.getTotalConEnvio();

      if (cartTotals) {
        cartTotals.style.display = this.carrito.length > 0 ? 'block' : 'none';
      }

      if (subtotalElement) {
        subtotalElement.textContent = `$${subtotal.toLocaleString()}`;
      }

      if (envioElement) {
        if (envio === 0 && subtotal > 0) {
          envioElement.textContent = 'GRATIS';
          envioElement.className = 'costo-envio-gratis';
        } else {
          envioElement.textContent = `$${envio.toLocaleString()}`;
          envioElement.className = 'costo-envio-normal';
        }
      }

      if (envioGratisElement) {
        const faltante = this.getFaltanteEnvioGratis();
        if (faltante > 0 && subtotal > 0) {
          envioGratisElement.innerHTML = `¬°Faltan <span class="text-success">$${faltante.toLocaleString()}</span> para ENV√çO GRATIS!`;
          envioGratisElement.style.display = 'block';
        } else {
          envioGratisElement.style.display = 'none';
        }
      }

      if (totalElement) {
        totalElement.textContent = `$${totalConEnvio.toLocaleString()}`;
      }
    }

    // üî• CORRECCI√ìN: Funci√≥n actualizada con funciones globales
    actualizarListaCarrito() {
      const listaCarrito = document.getElementById('listaCarrito');
      if (!listaCarrito) return;

      if (this.carrito.length === 0) {
        listaCarrito.innerHTML = `
          <div class="sin-productos">
            <p>Tu carrito est√° vac√≠o</p>
            <button class="btn-agregar" onclick="cerrarModal('modalCarrito')" style="margin-top: 15px; max-width: 200px;">
              Seguir comprando
            </button>
          </div>
        `;
        return;
      }

      // üî• CORRECCI√ìN: Usar las funciones globales
      listaCarrito.innerHTML = this.carrito.map(item => `
        <div class="producto-carrito">
          <div class="producto-info">
            <h4>${item.nombre}</h4>
            <p class="precio">$${item.precio.toLocaleString()} c/u</p>
          </div>
          <div class="producto-cantidad">
            <button class="btn-cantidad" onclick="restarProducto('${item.id}')">-</button>
            <span style="min-width: 30px; text-align: center;">${item.cantidad}</span>
            <button class="btn-cantidad" onclick="sumarProducto('${item.id}')">+</button>
            <button class="btn-cantidad" onclick="eliminarProducto('${item.id}')" style="margin-left: 10px; background: #ff4444; color: white;">√ó</button>
          </div>
          <div class="precio">$${(item.precio * item.cantidad).toLocaleString()}</div>
        </div>
      `).join('');
    }

    mostrarNotificacion(mensaje) {
      let notificacion = document.getElementById('notificacion-carrito');
      if (!notificacion) {
        notificacion = document.createElement('div');
        notificacion.id = 'notificacion-carrito';
        notificacion.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: #25D366;
          color: white;
          padding: 12px 20px;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          z-index: 9999;
          font-weight: bold;
          transform: translateX(400px);
          transition: transform 0.3s ease;
          max-width: 300px;
        `;
        document.body.appendChild(notificacion);
      }

      notificacion.textContent = mensaje;
      notificacion.style.transform = 'translateX(0)';

      setTimeout(() => {
        notificacion.style.transform = 'translateX(400px)';
      }, 3000);
    }

    generarMensajeWhatsApp(infoCliente = {}) {
      const subtotal = this.getTotal();
      const envio = this.getCostoEnvio();
      const total = this.getTotalConEnvio();
      
      let mensaje = `¬°Hola! Quiero hacer este pedido:%0A%0A`;
      
      this.carrito.forEach(item => {
        mensaje += `‚û° ${item.nombre} x${item.cantidad} - $${(item.precio * item.cantidad).toLocaleString()}%0A`;
      });
      
      mensaje += `%0Aüì¶ Subtotal: $${subtotal.toLocaleString()}`;
      
      if (envio === 0 && subtotal > 0) {
        mensaje += `%0Aüöö Env√≠o: GRATIS`;
      } else if (envio > 0) {
        mensaje += `%0Aüöö Env√≠o: $${envio.toLocaleString()}`;
      }
      
      mensaje += `%0Aüíµ Total: $${total.toLocaleString()}`;
      
      if (subtotal < this.MINIMO_ENVIO_GRATIS && subtotal > 0) {
        const faltante = this.getFaltanteEnvioGratis();
        mensaje += `%0A%0Aüéâ ¬°Faltan $${faltante.toLocaleString()} para ENV√çO GRATIS!`;
      }
      
      if (infoCliente.nombre) {
        mensaje += `%0A%0Aüë§ Cliente: ${infoCliente.nombre}`;
      }
      if (infoCliente.telefono) {
        mensaje += `%0Aüìû Tel√©fono: ${infoCliente.telefono}`;
      }
      if (infoCliente.direccion) {
        mensaje += `%0Aüìç Direcci√≥n: ${infoCliente.direccion}`;
      } else {
        mensaje += `%0A%0Aüìç Direcci√≥n de env√≠o: [COMPLETAR]`;
      }
      
      mensaje += `%0A%0A¬°Gracias!`;
      
      return mensaje;
    }

    enviarPorWhatsApp() {
      const modalCliente = document.getElementById('modalInfoCliente');
      if (modalCliente) {
        modalCliente.style.display = 'flex';
      } else {
        const mensaje = this.generarMensajeWhatsApp();
        const telefono = this.configTienda.whatsapp || '5493624840349';
        const whatsappURL = `https://wa.me/${telefono}?text=${mensaje}`;
        window.open(whatsappURL, '_blank');
      }
    }

    confirmarPedidoConCliente() {
      const nombre = document.getElementById('clienteNombre')?.value || '';
      const telefono = document.getElementById('clienteTelefono')?.value || '';
      const direccion = document.getElementById('clienteDireccion')?.value || '';
      
      if (!nombre || !telefono || !direccion) {
        this.mostrarNotificacion('‚ùå Por favor completa todos los campos');
        return;
      }
      
      const infoCliente = { nombre, telefono, direccion };
      const mensaje = this.generarMensajeWhatsApp(infoCliente);
      const telefonoWhatsApp = this.configTienda.whatsapp || '5493624840349';
      const whatsappURL = `https://wa.me/${telefonoWhatsApp}?text=${mensaje}`;
      
      this.cerrarModal('modalInfoCliente');
      window.open(whatsappURL, '_blank');
      this.limpiarCarrito();
    }

    cerrarModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.style.display = 'none';
      }
    }

    abrirCarrito() {
      const modal = document.getElementById('modalCarrito');
      if (modal) {
        modal.style.display = 'flex';
        this.actualizarUI();
      }
    }
  }

  // =============================================
  // SISTEMA PRINCIPAL MEJORADO CON BANNERS DIN√ÅMICOS
  // =============================================

  class PuntoAlmacenApp {
    constructor() {
      this.productos = [];
      this.banners = {
        oferta: null,
        rifas: null
      };
      this.filtroActual = 'todos';
      this.terminoBusqueda = '';
      this.cart = new CartService();
    }

    async init() {
      try {
        console.log('üõçÔ∏è Inicializando PuntoAlmacen App...');
        await this.cargarBanners();
        await this.cargarProductos();
        this.inicializarEventos();
        console.log('‚úÖ PuntoAlmacen App inicializada correctamente');
      } catch (error) {
        console.error('‚ùå Error inicializando app:', error);
      }
    }

    // M√©todo para cargar banners desde Back4app - MEJORADO
    async cargarBanners() {
      try {
        console.log('üñºÔ∏è Cargando banners desde Back4app...');
        
        // Cargar banner de oferta
        const bannerOferta = await Banner.obtenerBannerPorTipo('oferta');
        if (bannerOferta && bannerOferta.get('activo') !== false) {
          console.log('‚úÖ Banner oferta encontrado y activo');
          this.banners.oferta = {
            titulo: bannerOferta.get('titulo') || 'Oferta Especial',
            descripcion: bannerOferta.get('descripcion') || 'Descuentos hasta 50%',
            imagen: bannerOferta.get('imagen') ? bannerOferta.get('imagen').url() : 'img/banner-oferta.jpg',
            enlace: bannerOferta.get('enlace') || 'https://wa.me/5493624840349?text=Quiero%20la%20oferta%20del%20d√≠a',
            activo: true
          };
        } else {
          console.log('‚ÑπÔ∏è Banner oferta no encontrado o inactivo');
          this.banners.oferta = null;
        }
        
        // Cargar banner de rifas
        const bannerRifas = await Banner.obtenerBannerPorTipo('rifas');
        if (bannerRifas && bannerRifas.get('activo') !== false) {
          console.log('‚úÖ Banner rifas encontrado y activo');
          this.banners.rifas = {
            titulo: bannerRifas.get('titulo') || 'üéâ ¬°Participa en Nuestras Rifas! üéâ',
            descripcion: bannerRifas.get('descripcion') || 'Gana premios incre√≠bles - ¬°Es muy f√°cil participar!',
            imagen: bannerRifas.get('imagen') ? bannerRifas.get('imagen').url() : 'https://via.placeholder.com/1200x300/FF6B35/ffffff?text=PARTICIPA+EN+NUESTRAS+RIFAS+ONLINE',
            enlace: bannerRifas.get('enlace') || 'https://rifasapponline.netlify.app/',
            activo: true
          };
        } else {
          console.log('‚ÑπÔ∏è Banner rifas no encontrado o inactivo');
          this.banners.rifas = null;
        }
        
        this.renderizarBanners();
        
      } catch (error) {
        console.error('‚ùå Error cargando banners:', error);
        this.mostrarBannersPorDefecto();
      }
    }

    // M√©todo para renderizar banners en la UI - MEJORADO
    renderizarBanners() {
      // Renderizar banner de oferta
      if (this.banners.oferta) {
        const bannerOfertaContainer = document.getElementById('banner-oferta-container');
        const bannerOfertaImg = document.getElementById('banner-oferta-img');
        const btnOfertaLink = document.getElementById('btn-oferta-link');
        
        if (bannerOfertaContainer) {
          bannerOfertaContainer.style.display = 'block';
        }
        
        if (bannerOfertaImg) {
          bannerOfertaImg.src = this.banners.oferta.imagen;
          bannerOfertaImg.alt = this.banners.oferta.titulo;
        }
        
        if (btnOfertaLink) {
          btnOfertaLink.href = this.banners.oferta.enlace;
          // Actualizar el enlace con el n√∫mero de WhatsApp configurado
          const whatsapp = this.cart.configTienda.whatsapp || '5493624840349';
          btnOfertaLink.href = btnOfertaLink.href.replace(/wa\.me\/\d+/, `wa.me/${whatsapp}`);
        }
      } else {
        this.ocultarBannerOferta();
      }
      
      // Renderizar banner de rifas
      if (this.banners.rifas) {
        const bannerRifasContainer = document.getElementById('banner-rifas-container');
        const bannerRifasImg = document.getElementById('banner-rifas-img');
        const bannerRifasTitulo = document.getElementById('banner-rifas-titulo');
        const bannerRifasDescripcion = document.getElementById('banner-rifas-descripcion');
        const bannerRifasLink = document.getElementById('banner-rifas-link');
        
        if (bannerRifasContainer) {
          bannerRifasContainer.style.display = 'block';
        }
        
        if (bannerRifasImg) {
          bannerRifasImg.src = this.banners.rifas.imagen;
          bannerRifasImg.alt = this.banners.rifas.titulo;
        }
        
        if (bannerRifasTitulo) {
          bannerRifasTitulo.textContent = this.banners.rifas.titulo;
        }
        
        if (bannerRifasDescripcion) {
          bannerRifasDescripcion.textContent = this.banners.rifas.descripcion;
        }
        
        if (bannerRifasLink) {
          bannerRifasLink.href = this.banners.rifas.enlace;
        }
      } else {
        this.ocultarBannerRifas();
      }
    }

    // M√©todos auxiliares para manejar banners
    ocultarBannerOferta() {
      const bannerOfertaContainer = document.getElementById('banner-oferta-container');
      if (bannerOfertaContainer) {
        bannerOfertaContainer.style.display = 'none';
      }
    }
    
    ocultarBannerRifas() {
      const bannerRifasContainer = document.getElementById('banner-rifas-container');
      if (bannerRifasContainer) {
        bannerRifasContainer.style.display = 'none';
      }
    }
    
    mostrarBannersPorDefecto() {
      console.log('üîÑ Usando banners por defecto');
      // Los banners por defecto ya est√°n en el HTML
    }

    async cargarProductos() {
      try {
        this.mostrarLoading(true);
        
        // Cargar productos desde Back4app
        const productosBack4app = await Producto.obtenerTodos();
        
        if (productosBack4app.length > 0) {
          this.productos = productosBack4app.map(producto => ({
            id: producto.id,
            nombre: producto.get('nombre'),
            precio: producto.get('precio'),
            categoria: producto.get('categoria'),
            imagen: producto.get('imagen') || 'https://via.placeholder.com/300x250/25D366/ffffff?text=Producto',
            destacado: producto.get('destacado') || false,
            descripcion: producto.get('descripcion') || '',
            talles: producto.get('talles') || null,
            garantia: producto.get('garantia') || null,
            activo: producto.get('activo') !== false
          }));
          console.log(`‚úÖ ${this.productos.length} productos cargados desde Back4app`);
        } else {
          // Usar productos por defecto si no hay en Back4app
          this.productos = [
            { id: '1', nombre: "Arroz Largo Fino 1kg", precio: 450, categoria: "almacen", imagen: "https://via.placeholder.com/300x250/25D366/ffffff?text=Arroz", destacado: true, activo: true },
            { id: '2', nombre: "Fideos Tallar√≠n 500g", precio: 320, categoria: "almacen", imagen: "https://via.placeholder.com/300x250/25D366/ffffff?text=Fideos", activo: true },
            { id: '3', nombre: "Aceite de Girasol 1L", precio: 780, categoria: "almacen", imagen: "https://via.placeholder.com/300x250/25D366/ffffff?text=Aceite", destacado: true, activo: true }
          ];
          console.log('‚ÑπÔ∏è Usando productos por defecto');
        }

        this.renderizarProductos();
        this.mostrarLoading(false);
        
      } catch (error) {
        console.error('‚ùå Error cargando productos:', error);
        this.mostrarLoading(false);
        this.mostrarError('Error cargando productos. Intenta recargar la p√°gina.');
      }
    }

    renderizarProductos() {
      const secciones = {
        almacen: document.getElementById('almacen'),
        indumentaria: document.getElementById('indumentaria'),
        electro: document.getElementById('electro'),
        libreria: document.getElementById('libreria')
      };

      // Limpiar secciones
      Object.values(secciones).forEach(seccion => {
        if (seccion) seccion.innerHTML = '';
      });

      // Filtrar productos
      let productosFiltrados = this.productos.filter(p => p.activo !== false);
      
      if (this.terminoBusqueda) {
        productosFiltrados = productosFiltrados.filter(producto =>
          producto.nombre.toLowerCase().includes(this.terminoBusqueda.toLowerCase()) ||
          (producto.descripcion && producto.descripcion.toLowerCase().includes(this.terminoBusqueda.toLowerCase()))
        );
      }

      if (this.filtroActual !== 'todos') {
        productosFiltrados = productosFiltrados.filter(producto => 
          producto.categoria === this.filtroActual
        );
      }

      // Ocultar todas las secciones primero
      document.querySelectorAll('.titulo-seccion').forEach(titulo => {
        titulo.style.display = 'none';
      });
      document.querySelectorAll('.grilla').forEach(grilla => {
        grilla.style.display = 'none';
      });

      // Agrupar por categor√≠a y renderizar
      const productosPorCategoria = {};
      productosFiltrados.forEach(producto => {
        if (!productosPorCategoria[producto.categoria]) {
          productosPorCategoria[producto.categoria] = [];
        }
        productosPorCategoria[producto.categoria].push(producto);
      });

      Object.keys(productosPorCategoria).forEach(categoria => {
        const seccion = secciones[categoria];
        if (seccion) {
          seccion.style.display = 'grid';
          if (seccion.previousElementSibling) {
            seccion.previousElementSibling.style.display = 'block';
          }
          
          productosPorCategoria[categoria].forEach(producto => {
            const productoHTML = this.crearProductoHTML(producto);
            seccion.innerHTML += productoHTML;
          });
        }
      });

      // Mostrar mensaje si no hay productos
      if (productosFiltrados.length === 0) {
        this.mostrarMensajeSinProductos();
      }

      // Agregar eventos a los botones
      this.inicializarEventosProductos();
    }

    crearProductoHTML(producto) {
      return `
        <div class="producto-card">
          <div class="producto-imagen">
            <img src="${producto.imagen}" alt="${producto.nombre}" 
                 onerror="this.src='https://via.placeholder.com/300x250/25D366/ffffff?text=Producto'" 
                 loading="lazy">
            ${producto.destacado ? '<span class="badge-oferta">üî• OFERTA</span>' : ''}
          </div>
          <h3>${producto.nombre}</h3>
          ${producto.talles && producto.talles.length > 0 ? 
            `<p><small>Talles: ${producto.talles.join(', ')}</small></p>` : ''}
          ${producto.garantia ? `<p><small>üõ°Ô∏è Garant√≠a: ${producto.garantia}</small></p>` : ''}
          ${producto.descripcion ? `<p><small>${producto.descripcion}</small></p>` : ''}
          <div class="precio">$${producto.precio.toLocaleString()}</div>
          <button class="btn-agregar" data-id="${producto.id}">
            üõí Agregar al carrito
          </button>
        </div>
      `;
    }

    inicializarEventosProductos() {
      document.querySelectorAll('.btn-agregar').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const idProducto = e.target.dataset.id;
          const producto = this.productos.find(p => p.id === idProducto);
          if (producto) {
            this.cart.agregarProducto(producto);
          }
        });
      });
    }

    inicializarEventos() {
      // B√∫squeda
      const busqueda = document.getElementById('busqueda');
      if (busqueda) {
        busqueda.addEventListener('input', (e) => {
          this.terminoBusqueda = e.target.value;
          this.renderizarProductos();
        });
      }

      // Filtros
      const filtros = document.querySelectorAll('.btn-filtro');
      filtros.forEach(filtro => {
        filtro.addEventListener('click', () => {
          filtros.forEach(f => f.classList.remove('active'));
          filtro.classList.add('active');
          this.filtroActual = filtro.dataset.categoria;
          this.renderizarProductos();
        });
      });

      // Bot√≥n admin
      const btnAdmin = document.getElementById('btnAdmin');
      if (btnAdmin) {
        btnAdmin.addEventListener('click', () => {
          window.location.href = 'admin.html';
        });
      }

      // Eventos del carrito
      const carritoBtn = document.getElementById('carritoBtn');
      const cerrarModalBtn = document.getElementById('cerrarModal');
      const btnEnviarWhatsApp = document.getElementById('btnEnviarWhatsApp');
      
      if (carritoBtn) {
        carritoBtn.addEventListener('click', () => this.cart.abrirCarrito());
      }
      
      if (cerrarModalBtn) {
        cerrarModalBtn.addEventListener('click', () => this.cart.cerrarModal('modalCarrito'));
      }
      
      if (btnEnviarWhatsApp) {
        btnEnviarWhatsApp.addEventListener('click', () => this.cart.enviarPorWhatsApp());
      }

      // Cerrar modales al hacer clic fuera
      const modalCarrito = document.getElementById('modalCarrito');
      const modalCliente = document.getElementById('modalInfoCliente');
      
      [modalCarrito, modalCliente].forEach(modal => {
        if (modal) {
          modal.addEventListener('click', (e) => {
            if (e.target === modal) {
              this.cart.cerrarModal(modal.id);
            }
          });
        }
      });
    }

    mostrarLoading(mostrar) {
      const loadings = document.querySelectorAll('.loading');
      loadings.forEach(loading => {
        loading.style.display = mostrar ? 'block' : 'none';
      });
    }

    mostrarError(mensaje) {
      this.mostrarNotificacion(mensaje, 'error');
    }

    mostrarNotificacion(mensaje, tipo = 'success') {
      const notificacion = document.createElement('div');
      notificacion.className = 'notificacion';
      notificacion.textContent = mensaje;
      
      if (tipo === 'error') {
        notificacion.style.background = '#ff4444';
      }
      
      document.body.appendChild(notificacion);

      setTimeout(() => {
        if (document.body.contains(notificacion)) {
          document.body.removeChild(notificacion);
        }
      }, 3000);
    }

    mostrarMensajeSinProductos() {
      const container = document.querySelector('.container');
      const mensajeExistente = document.querySelector('.sin-productos-global');
      
      if (!mensajeExistente) {
        const mensaje = document.createElement('div');
        mensaje.className = 'sin-productos sin-productos-global';
        mensaje.innerHTML = `
          <h3>üòî No se encontraron productos</h3>
          <p>Intenta con otros t√©rminos de b√∫squeda o cambia de categor√≠a</p>
          <button class="btn-agregar" onclick="app.cargarProductos()" style="margin-top: 15px; max-width: 200px;">
            Reintentar carga
          </button>
        `;
        container.appendChild(mensaje);
      }
    }
  }

  // =============================================
  // INICIALIZACI√ìN GLOBAL
  // =============================================

  // Funci√≥n global para cerrar modales
  function cerrarModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.style.display = 'none';
    }
  }

  // Funci√≥n global para abrir carrito
  function abrirCarrito() {
    if (window.app && window.app.cart) {
      window.app.cart.abrirCarrito();
    }
  }

  // =============================================
  // üî• SOLUCI√ìN: FUNCIONES GLOBALES PARA EL CARRITO
  // =============================================

  // Funci√≥n para sumar cantidad
  function sumarProducto(id) {
    if (window.app && window.app.cart) {
      const item = window.app.cart.carrito.find(item => item.id === id);
      if (item) {
        window.app.cart.actualizarCantidad(id, item.cantidad + 1);
      }
    }
  }

  // Funci√≥n para restar cantidad  
  function restarProducto(id) {
    if (window.app && window.app.cart) {
      const item = window.app.cart.carrito.find(item => item.id === id);
      if (item) {
        window.app.cart.actualizarCantidad(id, item.cantidad - 1);
      }
    }
  }

  // Funci√≥n para eliminar producto
  function eliminarProducto(id) {
    if (window.app && window.app.cart) {
      window.app.cart.eliminarProducto(id);
    }
  }

  // Funci√≥n para vaciar carrito
  function vaciarCarrito() {
    if (window.app && window.app.cart) {
      window.app.cart.limpiarCarrito();
    }
  }

  // Inicializar la aplicaci√≥n cuando el DOM est√© listo
  document.addEventListener('DOMContentLoaded', async () => {
    window.app = new PuntoAlmacenApp();
    await window.app.init();
  });

</script>
</body>
</html>
<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>PuntoAlmacen ‚Äì Tienda por WhatsApp | Compr√° f√°cil desde tu casa</title>
  <meta name="description" content="Tienda de almac√©n, indumentaria y electrodom√©sticos. Hac√© tu pedido por WhatsApp y te lo llevamos a domicilio.">
  <meta name="keywords" content="almac√©n, tienda, electrodom√©sticos, indumentaria, compras, WhatsApp, delivery">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* ESTILOS GENERALES */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f8f9fa;
      color: #333;
      line-height: 1.6;
    }

    /* HEADER MEJORADO CON LOGO */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 5%;
      background: white;
      box-shadow: 0 2px 15px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo {
      height: 50px;
      width: auto;
      transition: transform 0.3s ease;
    }

    .logo:hover {
      transform: scale(1.05);
    }

    .logo-text {
      font-size: 1.5em;
      font-weight: bold;
      color: #25D366;
    }

    .logo-subtitle {
      font-size: 0.9em;
      color: #666;
      margin-top: -5px;
    }

    .btn-wsp-float {
      background: #25D366;
      padding: 12px 20px;
      border-radius: 25px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: white;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(37, 211, 102, 0.3);
    }

    .btn-wsp-float:hover {
      background: #128C7E;
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(37, 211, 102, 0.4);
    }

    .btn-wsp-float img {
      width: 24px;
      height: 24px;
    }

    /* HERO SECTION */
    .hero {
      position: relative;
      margin: 20px 5%;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }

    .hero img {
      width: 100%;
      height: 300px;
      object-fit: cover;
      display: block;
    }

    .btn-oferta {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background: #ff4444;
      color: white;
      padding: 12px 25px;
      border-radius: 25px;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .btn-oferta:hover {
      background: #cc0000;
      transform: scale(1.05);
    }

    /* BANNER RIFAS */
    .banner-rifas {
      margin: 30px 5%;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      position: relative;
    }

    .banner-rifas:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .banner-rifas a {
      display: block;
      text-decoration: none;
    }

    .banner-rifas img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
    }

    .banner-rifas-content {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.8));
      color: white;
      padding: 20px;
      text-align: center;
    }

    .banner-rifas h3 {
      font-size: 1.5em;
      margin-bottom: 5px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }

    .banner-rifas p {
      font-size: 1em;
      opacity: 0.9;
      margin-bottom: 10px;
    }

    .btn-rifas {
      background: #FF6B35;
      color: white;
      padding: 10px 20px;
      border-radius: 25px;
      text-decoration: none;
      font-weight: bold;
      display: inline-block;
      transition: all 0.3s ease;
    }

    .btn-rifas:hover {
      background: #E55A2B;
      transform: scale(1.05);
    }

    /* MAIN CONTENT */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .busqueda {
      width: 100%;
      padding: 15px;
      margin: 20px 0;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }

    .busqueda:focus {
      outline: none;
      border-color: #25D366;
    }

    .filtros {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 25px 0;
      flex-wrap: wrap;
    }

    .btn-filtro {
      padding: 10px 20px;
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .btn-filtro.active {
      background: #25D366;
      color: white;
      border-color: #25D366;
    }

    .btn-filtro:hover:not(.active) {
      background: #e9ecef;
    }

    .titulo-seccion {
      text-align: center;
      margin: 40px 0 20px 0;
      color: #2c3e50;
      font-size: 2em;
      position: relative;
    }

    .titulo-seccion::after {
      content: '';
      display: block;
      width: 60px;
      height: 4px;
      background: #25D366;
      margin: 10px auto;
      border-radius: 2px;
    }

    .grilla {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .producto-card {
      background: white;
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
      border: 1px solid #f1f3f4;
    }

    .producto-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.15);
    }

    .producto-imagen {
      position: relative;
      margin-bottom: 15px;
    }

    .producto-imagen img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 10px;
    }

    .badge-oferta {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #ff4444;
      color: white;
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 0.8em;
      font-weight: bold;
    }

    .badge-sin-stock {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #6c757d;
      color: white;
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 0.8em;
      font-weight: bold;
    }

    .producto-card h3 {
      margin: 15px 0 10px 0;
      color: #2c3e50;
      font-size: 1.2em;
    }

    .precio {
      font-weight: bold;
      color: #25D366;
      font-size: 1.4em;
      margin: 15px 0;
    }

    .btn-agregar {
      background: #25D366;
      color: white;
      border: none;
      padding: 12px 25px;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: bold;
      width: 100%;
    }

    .btn-agregar:hover {
      background: #128C7E;
      transform: translateY(-2px);
    }

    .btn-agregar:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: none;
    }

    /* BOTONES FLOTANTES */
    .btn-admin {
      position: fixed;
      bottom: 150px;
      right: 25px;
      background: #6c757d;
      color: white;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      cursor: pointer;
      z-index: 99;
      transition: all 0.3s ease;
      border: none;
      font-size: 24px;
    }

    .btn-admin:hover {
      transform: scale(1.1);
      background: #5a6268;
    }

    .carrito-flotante {
      position: fixed;
      bottom: 70px;
      right: 25px;
      background: #25D366;
      color: white;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      cursor: pointer;
      z-index: 99;
      transition: all 0.3s ease;
    }

    .carrito-flotante:hover {
      transform: scale(1.1);
    }

    .contador-carrito {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ff4444;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }

    /* MODAL CARRITO */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal-contenido {
      background: white;
      padding: 30px;
      border-radius: 15px;
      max-width: 90%;
      max-height: 80%;
      overflow-y: auto;
      width: 500px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    }

    .modal-cerrar {
      float: right;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }

    .modal-cerrar:hover {
      color: #333;
    }

    .producto-carrito {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid #eee;
    }

    .producto-info {
      flex-grow: 1;
    }

    .producto-cantidad {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .btn-cantidad {
      background: #f8f9fa;
      border: 1px solid #ddd;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-cantidad:hover {
      background: #e9ecef;
    }

    .btn-enviar-pedido {
      background: #25D366;
      color: white;
      border: none;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      width: 100%;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .btn-enviar-pedido:hover {
      background: #128C7E;
      transform: translateY(-2px);
    }

    /* FOOTER */
    footer {
      background: #2c3e50;
      color: white;
      text-align: center;
      padding: 30px 20px;
      margin-top: 50px;
    }

    footer a {
      color: #25D366;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* NOTIFICACIONES */
    .notificacion {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #25D366;
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      z-index: 1000;
      animation: fadeInOut 3s ease-in-out;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    @keyframes fadeInOut {
      0% { opacity: 0; transform: translateY(-20px); }
      20% { opacity: 1; transform: translateY(0); }
      80% { opacity: 1; transform: translateY(0); }
      100% { opacity: 0; transform: translateY(-20px); }
    }

    /* LOADING Y ESTADOS */
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
      font-size: 1.1em;
    }

    .sin-productos {
      text-align: center;
      padding: 40px;
      color: #666;
      grid-column: 1 / -1;
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      .header {
        padding: 10px 5%;
        flex-direction: column;
        gap: 15px;
      }

      .logo {
        height: 40px;
      }

      .hero img {
        height: 200px;
      }

      .banner-rifas img {
        height: 150px;
      }

      .banner-rifas-content {
        padding: 15px;
      }

      .banner-rifas h3 {
        font-size: 1.2em;
      }

      .banner-rifas p {
        font-size: 0.9em;
      }

      .grilla {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
      }

      .btn-admin, .carrito-flotante {
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
      }

      .btn-admin {
        bottom: 80px;
      }
    }

    /* üî• NUEVO: Estilos para el sistema de env√≠o */
    .cart-totals {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin-top: 20px;
    }

    .envio-gratis-msg {
      background: #d1edff;
      border: 1px solid #b3d9ff;
      border-radius: 8px;
      padding: 12px;
      margin: 10px 0;
      text-align: center;
    }

    .envio-gratis-msg .text-success {
      color: #198754;
      font-weight: bold;
    }

    .costo-envio-gratis {
      color: #198754;
      font-weight: bold;
    }

    .costo-envio-normal {
      color: #6c757d;
    }

    /* Modal de datos del cliente */
    .modal-cliente {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1001;
      align-items: center;
      justify-content: center;
    }

    .modal-cliente-contenido {
      background: white;
      padding: 30px;
      border-radius: 15px;
      max-width: 90%;
      width: 400px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #333;
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s ease;
    }

    .form-group input:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #25D366;
    }

    .btn-confirmar {
      background: #25D366;
      color: white;
      border: none;
      padding: 15px;
      border-radius: 10px;
      width: 100%;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .btn-confirmar:hover {
      background: #128C7E;
      transform: translateY(-2px);
    }
  </style>
</head>
<body>

<!-- HEADER CON LOGO -->
<header class="header">
  <div class="logo-container">
    <img src="img/logo.jpg.jpeg" alt="PuntoAlmacen - Tienda por WhatsApp" class="logo">
    <div>
      <div class="logo-text">PuntoAlmacen</div>
      <div class="logo-subtitle">Tienda por WhatsApp</div>
    </div>
  </div>
  
  <a class="btn-wsp-float" href="https://wa.me/5493624840349?text=Hola%20PuntoAlmacen,%20quiero%20hacer%20un%20pedido" target="_blank" aria-label="Contactar por WhatsApp">
    <img src="https://img.icons8.com/color/48/whatsapp.png" alt="WhatsApp"/>
    Pedir por WhatsApp
  </a>
</header>

<!-- BANNER OFERTA - Ahora din√°mico -->
<section class="hero">
  <img id="banner-oferta" src="img/banner-oferta.jpg" alt="Oferta especial - Descuentos hasta 50%">
  <a href="https://wa.me/5493624840349?text=Quiero%20la%20oferta%20del%20d√≠a" class="btn-oferta">Quiero mi oferta</a>
</section>

<!-- BANNER RIFAS ONLINE - Ahora din√°mico -->
<section class="banner-rifas" id="banner-rifas-container">
  <a href="https://rifasapponline.netlify.app/" target="_blank">
    <img id="banner-rifas-img" src="https://via.placeholder.com/1200x300/FF6B35/ffffff?text=PARTICIPA+EN+NUESTRAS+RIFAS+ONLINE" alt="Participa en nuestras rifas online">
    <div class="banner-rifas-content">
      <h3 id="banner-rifas-titulo">üéâ ¬°Participa en Nuestras Rifas! üéâ</h3>
      <p id="banner-rifas-descripcion">Gana premios incre√≠bles - ¬°Es muy f√°cil participar!</p>
      <span class="btn-rifas">Ver Rifas Online</span>
    </div>
  </a>
</section>

<!-- SECCIONES -->
<main class="container">
  <!-- Barra de b√∫squeda -->
  <input type="text" class="busqueda" placeholder="üîç Buscar productos..." id="busqueda">
  
  <!-- Filtros por categor√≠a -->
  <div class="filtros">
    <button class="btn-filtro active" data-categoria="todos">Todos los productos</button>
    <button class="btn-filtro" data-categoria="almacen">Almac√©n</button>
    <button class="btn-filtro" data-categoria="indumentaria">Indumentaria</button>
    <button class="btn-filtro" data-categoria="electro">Electro</button>
    <button class="btn-filtro" data-categoria="libreria">Librer√≠a</button>
  </div>

  <h2 class="titulo-seccion">Almac√©n</h2>
  <div class="grilla" id="almacen">
    <div class="loading">Cargando productos de almac√©n...</div>
  </div>

  <h2 class="titulo-seccion">Indumentaria</h2>
  <div class="grilla" id="indumentaria">
    <div class="loading">Cargando indumentaria...</div>
  </div>

  <h2 class="titulo-seccion">Electro</h2>
  <div class="grilla" id="electro">
    <div class="loading">Cargando electrodom√©sticos...</div>
  </div>

  <h2 class="titulo-seccion">Librer√≠a</h2>
  <div class="grilla" id="libreria">
    <div class="loading">Cargando productos de librer√≠a...</div>
  </div>

</main>

<!-- Bot√≥n Admin Flotante -->
<button class="btn-admin" id="btnAdmin" title="Panel de Administraci√≥n">‚öôÔ∏è</button>

<!-- Carrito flotante -->
<div class="carrito-flotante" id="carritoBtn">
  <div class="contador-carrito" id="contadorCarrito">0</div>
  <img src="https://img.icons8.com/ios-filled/30/ffffff/shopping-cart.png" alt="Carrito de compras">
</div>

<!-- Modal del carrito -->
<div class="modal" id="modalCarrito">
  <div class="modal-contenido">
    <button class="modal-cerrar" id="cerrarModal">&times;</button>
    <h2>üõí Tu Pedido</h2>
    <div id="listaCarrito">
      <div class="sin-productos">No hay productos en el carrito</div>
    </div>
    
    <!-- üî• NUEVO: Secci√≥n de totales con env√≠o -->
    <div class="cart-totals" id="cartTotals" style="display: none;">
      <div class="d-flex justify-content-between mb-2">
        <span>Subtotal:</span>
        <span id="subtotal-carrito">$0</span>
      </div>
      <div class="d-flex justify-content-between mb-2">
        <span>Env√≠o:</span>
        <span id="costo-envio">$0</span>
      </div>
      <div id="envio-gratis-msg" class="envio-gratis-msg" style="display: none;"></div>
      <div class="d-flex justify-content-between mb-3">
        <strong>Total:</strong>
        <strong id="total-carrito">$0</strong>
      </div>
      
      <button class="btn-enviar-pedido" id="btnEnviarWhatsApp">
        üì± Enviar por WhatsApp
      </button>
      
      <button class="btn-enviar-pedido" onclick="cart.limpiarCarrito()" style="background: #dc3545; margin-top: 10px;">
        üóëÔ∏è Vaciar Carrito
      </button>
    </div>
  </div>
</div>

<!-- üî• NUEVO: Modal de datos del cliente -->
<div class="modal-cliente" id="modalInfoCliente">
  <div class="modal-cliente-contenido">
    <button class="modal-cerrar" onclick="cerrarModal('modalInfoCliente')">&times;</button>
    <h2>üë§ Datos de Env√≠o</h2>
    
    <div class="form-group">
      <label for="clienteNombre">Nombre completo *</label>
      <input type="text" id="clienteNombre" placeholder="Tu nombre completo" required>
    </div>
    
    <div class="form-group">
      <label for="clienteTelefono">Tel√©fono *</label>
      <input type="tel" id="clienteTelefono" placeholder="11 1234-5678" required>
    </div>
    
    <div class="form-group">
      <label for="clienteDireccion">Direcci√≥n de env√≠o *</label>
      <textarea id="clienteDireccion" placeholder="Calle, n√∫mero, piso, departamento, ciudad..." required></textarea>
    </div>
    
    <button class="btn-confirmar" onclick="cart.confirmarPedidoConCliente()">
      ‚úÖ Confirmar y Enviar por WhatsApp
    </button>
  </div>
</div>

<!-- FOOTER -->
<footer>
  <p id="footer-info">¬© 2025 PuntoAlmacen ‚Äì Horarios: Lunes a Viernes 9-18 hs</p>
  <p id="footer-contacto">üìç Calle Falsa 123, Ciudad ‚Äì <a href="https://wa.me/5493624840349">WhatsApp: +54 9 3624 840-349</a></p>
  <p><a href="admin.html" style="color: #ccc; font-size: 12px;">Panel de Administraci√≥n</a></p>
</footer>

<script>
  // =============================================
  // SISTEMA MEJORADO DE CARRITO CON ENV√çO GRATIS
  // =============================================

  class CartService {
    constructor() {
      this.carrito = this.cargarCarrito();
      this.COSTO_ENVIO_NORMAL = 800;
      this.MINIMO_ENVIO_GRATIS = 10000;
      
      // Cargar configuraci√≥n desde localStorage
      this.cargarConfiguracionEnvio();
    }

    cargarConfiguracionEnvio() {
      const configEnvio = JSON.parse(localStorage.getItem('configEnvioPuntoAlmacen'));
      if (configEnvio) {
        this.COSTO_ENVIO_NORMAL = configEnvio.COSTO_ENVIO_NORMAL || 800;
        this.MINIMO_ENVIO_GRATIS = configEnvio.MINIMO_ENVIO_GRATIS || 10000;
      }
    }

    cargarCarrito() {
      try {
        return JSON.parse(localStorage.getItem('carritoPuntoAlmacen')) || [];
      } catch (error) {
        console.error('Error cargando carrito:', error);
        return [];
      }
    }

    guardarCarrito() {
      try {
        localStorage.setItem('carritoPuntoAlmacen', JSON.stringify(this.carrito));
      } catch (error) {
        console.error('Error guardando carrito:', error);
      }
    }

    agregarProducto(producto) {
      const existente = this.carrito.find(item => item.id === producto.id);
      
      if (existente) {
        existente.cantidad += 1;
      } else {
        this.carrito.push({
          ...producto,
          cantidad: 1
        });
      }
      
      this.guardarCarrito();
      this.actualizarUI();
      this.mostrarNotificacion(`${producto.nombre} agregado al carrito`);
    }

    eliminarProducto(id) {
      const producto = this.carrito.find(item => item.id === id);
      this.carrito = this.carrito.filter(item => item.id !== id);
      this.guardarCarrito();
      this.actualizarUI();
      
      if (producto) {
        this.mostrarNotificacion(`${producto.nombre} eliminado del carrito`);
      }
    }

    actualizarCantidad(id, nuevaCantidad) {
      const item = this.carrito.find(item => item.id === id);
      if (item) {
        if (nuevaCantidad <= 0) {
          this.eliminarProducto(id);
        } else {
          item.cantidad = nuevaCantidad;
          this.guardarCarrito();
          this.actualizarUI();
        }
      }
    }

    limpiarCarrito() {
      this.carrito = [];
      this.guardarCarrito();
      this.actualizarUI();
      this.mostrarNotificacion('Carrito vaciado');
    }

    getTotal() {
      return this.carrito.reduce((total, item) => total + (item.precio * item.cantidad), 0);
    }

    getCantidadTotal() {
      return this.carrito.reduce((total, item) => total + item.cantidad, 0);
    }

    // üî• NUEVO: Calcular costo de env√≠o
    getCostoEnvio() {
      const subtotal = this.getTotal();
      
      if (subtotal >= this.MINIMO_ENVIO_GRATIS || subtotal === 0) {
        return 0;
      }
      return this.COSTO_ENVIO_NORMAL;
    }

    // üî• NUEVO: Obtener total con env√≠o
    getTotalConEnvio() {
      return this.getTotal() + this.getCostoEnvio();
    }

    // üî• NUEVO: Calcular cu√°nto falta para env√≠o gratis
    getFaltanteEnvioGratis() {
      const subtotal = this.getTotal();
      if (subtotal >= this.MINIMO_ENVIO_GRATIS) {
        return 0;
      }
      return this.MINIMO_ENVIO_GRATIS - subtotal;
    }

    // üî• NUEVO: Verificar si aplica env√≠o gratis
    aplicaEnvioGratis() {
      return this.getTotal() >= this.MINIMO_ENVIO_GRATIS;
    }

    actualizarUI() {
      // Actualizar contador del carrito
      const contador = document.getElementById('contadorCarrito');
      if (contador) {
        const total = this.getCantidadTotal();
        contador.textContent = total;
        contador.style.display = total > 0 ? 'flex' : 'none';
      }

      // Actualizar display de env√≠o y totales
      this.actualizarDisplayEnvio();
      
      // Actualizar lista de productos en el modal
      this.actualizarListaCarrito();
    }

    // üî• NUEVO: Actualizar la interfaz de env√≠o
    actualizarDisplayEnvio() {
      const envioElement = document.getElementById('costo-envio');
      const envioGratisElement = document.getElementById('envio-gratis-msg');
      const subtotalElement = document.getElementById('subtotal-carrito');
      const totalElement = document.getElementById('total-carrito');
      const cartTotals = document.getElementById('cartTotals');
      
      const subtotal = this.getTotal();
      const envio = this.getCostoEnvio();
      const totalConEnvio = this.getTotalConEnvio();

      // Mostrar/ocultar secci√≥n de totales
      if (cartTotals) {
        cartTotals.style.display = this.carrito.length > 0 ? 'block' : 'none';
      }

      // Actualizar subtotal
      if (subtotalElement) {
        subtotalElement.textContent = `$${subtotal}`;
      }

      // Actualizar env√≠o
      if (envioElement) {
        if (envio === 0 && subtotal > 0) {
          envioElement.textContent = 'GRATIS';
          envioElement.className = 'costo-envio-gratis';
        } else {
          envioElement.textContent = `$${envio}`;
          envioElement.className = 'costo-envio-normal';
        }
      }

      // Actualizar mensaje de env√≠o gratis
      if (envioGratisElement) {
        const faltante = this.getFaltanteEnvioGratis();
        if (faltante > 0 && subtotal > 0) {
          envioGratisElement.innerHTML = `¬°Faltan <span class="text-success">$${faltante}</span> para ENV√çO GRATIS!`;
          envioGratisElement.style.display = 'block';
        } else {
          envioGratisElement.style.display = 'none';
        }
      }

      // Actualizar total
      if (totalElement) {
        totalElement.textContent = `$${totalConEnvio}`;
      }
    }

    // üî• NUEVO: Actualizar lista de productos en el modal
    actualizarListaCarrito() {
      const listaCarrito = document.getElementById('listaCarrito');
      if (!listaCarrito) return;

      if (this.carrito.length === 0) {
        listaCarrito.innerHTML = `
          <div class="sin-productos">
            <p>Tu carrito est√° vac√≠o</p>
            <button class="btn-agregar" onclick="cerrarModal('modalCarrito')" style="margin-top: 15px; max-width: 200px;">
              Seguir comprando
            </button>
          </div>
        `;
        return;
      }

      listaCarrito.innerHTML = this.carrito.map(item => `
        <div class="producto-carrito">
          <div class="producto-info">
            <h4>${item.nombre}</h4>
            <p class="precio">$${item.precio} c/u</p>
          </div>
          <div class="producto-cantidad">
            <button class="btn-cantidad" onclick="cart.actualizarCantidad(${item.id}, ${item.cantidad - 1})">-</button>
            <span style="min-width: 30px; text-align: center;">${item.cantidad}</span>
            <button class="btn-cantidad" onclick="cart.actualizarCantidad(${item.id}, ${item.cantidad + 1})">+</button>
            <button class="btn-cantidad" onclick="cart.eliminarProducto(${item.id})" style="margin-left: 10px; background: #ff4444; color: white;">√ó</button>
          </div>
          <div class="precio">$${item.precio * item.cantidad}</div>
        </div>
      `).join('');
    }

    // üî• NUEVO: Mostrar notificaciones
    mostrarNotificacion(mensaje) {
      // Crear notificaci√≥n si no existe
      let notificacion = document.getElementById('notificacion-carrito');
      if (!notificacion) {
        notificacion = document.createElement('div');
        notificacion.id = 'notificacion-carrito';
        notificacion.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: #25D366;
          color: white;
          padding: 12px 20px;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          z-index: 9999;
          font-weight: bold;
          transform: translateX(400px);
          transition: transform 0.3s ease;
          max-width: 300px;
        `;
        document.body.appendChild(notificacion);
      }

      notificacion.textContent = mensaje;
      notificacion.style.transform = 'translateX(0)';

      // Ocultar despu√©s de 3 segundos
      setTimeout(() => {
        notificacion.style.transform = 'translateX(400px)';
      }, 3000);
    }

    // üî• NUEVO: Generar mensaje de WhatsApp con env√≠o
    generarMensajeWhatsApp(infoCliente = {}) {
      const subtotal = this.getTotal();
      const envio = this.getCostoEnvio();
      const total = this.getTotalConEnvio();
      
      let mensaje = `¬°Hola! Quiero hacer este pedido:%0A%0A`;
      
      this.carrito.forEach(item => {
        mensaje += `‚û° ${item.nombre} x${item.cantidad} - $${item.precio * item.cantidad}%0A`;
      });
      
      mensaje += `%0Aüì¶ Subtotal: $${subtotal}`;
      
      if (envio === 0 && subtotal > 0) {
        mensaje += `%0Aüöö Env√≠o: GRATIS`;
      } else if (envio > 0) {
        mensaje += `%0Aüöö Env√≠o: $${envio}`;
      }
      
      mensaje += `%0Aüíµ Total: $${total}`;
      
      // Mensaje de env√≠o gratis
      if (subtotal < this.MINIMO_ENVIO_GRATIS && subtotal > 0) {
        const faltante = this.getFaltanteEnvioGratis();
        mensaje += `%0A%0Aüéâ ¬°Faltan $${faltante} para ENV√çO GRATIS!`;
      }
      
      // Informaci√≥n del cliente
      if (infoCliente.nombre) {
        mensaje += `%0A%0Aüë§ Cliente: ${infoCliente.nombre}`;
      }
      if (infoCliente.telefono) {
        mensaje += `%0Aüìû Tel√©fono: ${infoCliente.telefono}`;
      }
      if (infoCliente.direccion) {
        mensaje += `%0Aüìç Direcci√≥n: ${infoCliente.direccion}`;
      } else {
        mensaje += `%0A%0Aüìç Direcci√≥n de env√≠o: [COMPLETAR]`;
      }
      
      mensaje += `%0A%0A¬°Gracias!`;
      
      return mensaje;
    }

    // üî• NUEVO: Enviar pedido por WhatsApp
    enviarPorWhatsApp() {
      const modalCliente = document.getElementById('modalInfoCliente');
      if (modalCliente) {
        // Mostrar modal para datos del cliente primero
        modalCliente.style.display = 'flex';
      } else {
        // Enviar directamente si no hay modal
        const mensaje = this.generarMensajeWhatsApp();
        const config = JSON.parse(localStorage.getItem('configuracionPuntoAlmacen')) || {};
        const telefono = config.whatsapp || '5493624840349';
        const whatsappURL = `https://wa.me/${telefono}?text=${mensaje}`;
        window.open(whatsappURL, '_blank');
      }
    }

    // üî• NUEVO: Confirmar pedido con datos del cliente
    confirmarPedidoConCliente() {
      const nombre = document.getElementById('clienteNombre')?.value || '';
      const telefono = document.getElementById('clienteTelefono')?.value || '';
      const direccion = document.getElementById('clienteDireccion')?.value || '';
      
      // Validar campos requeridos
      if (!nombre || !telefono || !direccion) {
        this.mostrarNotificacion('‚ùå Por favor completa todos los campos');
        return;
      }
      
      const infoCliente = { nombre, telefono, direccion };
      const mensaje = this.generarMensajeWhatsApp(infoCliente);
      const config = JSON.parse(localStorage.getItem('configuracionPuntoAlmacen')) || {};
      const telefonoWhatsApp = config.whatsapp || '5493624840349';
      const whatsappURL = `https://wa.me/${telefonoWhatsApp}?text=${mensaje}`;
      
      // Cerrar modal
      this.cerrarModal('modalInfoCliente');
      
      // Abrir WhatsApp
      window.open(whatsappURL, '_blank');
      
      // Limpiar carrito despu√©s de enviar
      this.limpiarCarrito();
    }

    // üî• NUEVO: Cerrar modal
    cerrarModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.style.display = 'none';
      }
    }

    // üî• NUEVO: Abrir carrito
    abrirCarrito() {
      const modal = document.getElementById('modalCarrito');
      if (modal) {
        modal.style.display = 'flex';
        this.actualizarUI();
      }
    }
  }

  // =============================================
  // INICIALIZACI√ìN DEL SISTEMA
  // =============================================

  // Instancia global del carrito
  const cart = new CartService();

  // Funci√≥n global para cerrar modales
  function cerrarModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.style.display = 'none';
    }
  }

  // Funci√≥n global para abrir carrito
  function abrirCarrito() {
    cart.abrirCarrito();
  }

  // Inicializaci√≥n cuando el DOM est√© listo
  document.addEventListener('DOMContentLoaded', function() {
    // Inicializar eventos del carrito
    const carritoBtn = document.getElementById('carritoBtn');
    const cerrarModalBtn = document.getElementById('cerrarModal');
    const btnEnviarWhatsApp = document.getElementById('btnEnviarWhatsApp');
    
    if (carritoBtn) {
      carritoBtn.addEventListener('click', () => cart.abrirCarrito());
    }
    
    if (cerrarModalBtn) {
      cerrarModalBtn.addEventListener('click', () => cart.cerrarModal('modalCarrito'));
    }
    
    if (btnEnviarWhatsApp) {
      btnEnviarWhatsApp.addEventListener('click', () => cart.enviarPorWhatsApp());
    }
    
    // Cerrar modal al hacer clic fuera
    const modalCarrito = document.getElementById('modalCarrito');
    if (modalCarrito) {
      modalCarrito.addEventListener('click', (e) => {
        if (e.target === modalCarrito) {
          cart.cerrarModal('modalCarrito');
        }
      });
    }
    
    const modalCliente = document.getElementById('modalInfoCliente');
    if (modalCliente) {
      modalCliente.addEventListener('click', (e) => {
        if (e.target === modalCliente) {
          cart.cerrarModal('modalInfoCliente');
        }
      });
    }
    
    // Actualizar UI inicial
    cart.actualizarUI();
    
    console.log('üõí Sistema de carrito con env√≠o gratis inicializado');
  });

  // =============================================
  // SISTEMA EXISTENTE DE LA TIENDA (COMPATIBLE)
  // =============================================

  // ... (el resto del c√≥digo existente de la tienda permanece igual)
  // Solo se reemplaz√≥ el sistema de carrito anterior por la nueva clase CartService

  // Constantes para claves de localStorage (COMPATIBLES CON ADMIN)
  const STORAGE_KEYS = {
    PRODUCTOS: 'productosPuntoAlmacen',
    CARRITO: 'carritoPuntoAlmacen',
    BANNER_OFERTA: 'bannerOfertaPuntoAlmacen',
    BANNER_RIFAS: 'bannerRifasPuntoAlmacen',
    PEDIDOS: 'pedidosPuntoAlmacen',
    CONFIG: 'configuracionPuntoAlmacen'
  };

  // Productos por defecto (solo se usan si no hay datos en localStorage)
  const PRODUCTOS_POR_DEFECTO = [
    { id: 1, nombre: "Arroz Largo Fino 1kg", precio: 450, categoria: "almacen", imagen: "https://via.placeholder.com/300x200/25D366/ffffff?text=Arroz", destacado: true },
    { id: 2, nombre: "Fideos Tallar√≠n 500g", precio: 320, categoria: "almacen", imagen: "https://via.placeholder.com/300x200/25D366/ffffff?text=Fideos" },
    { id: 3, nombre: "Aceite de Girasol 1L", precio: 780, categoria: "almacen", imagen: "https://via.placeholder.com/300x200/25D366/ffffff?text=Aceite", destacado: true },
    { id: 4, nombre: "Harina 0000 1kg", precio: 280, categoria: "almacen", imagen: "https://via.placeholder.com/300x200/25D366/ffffff?text=Harina" },
    { id: 5, nombre: "Remera B√°sica Negra", precio: 2500, categoria: "indumentaria", imagen: "https://via.placeholder.com/300x200/25D366/ffffff?text=Remera", talles: ["S", "M", "L", "XL"] },
    { id: 6, nombre: "Pantal√≥n Jean Cl√°sico", precio: 4500, categoria: "indumentaria", imagen: "https://via.placeholder.com/300x200/25D366/ffffff?text=Pantalon", talles: ["38", "40", "42", "44"] },
    { id: 7, nombre: "Buzo Canguro Algod√≥n", precio: 5200, categoria: "indumentaria", imagen: "https://via.placeholder.com/300x200/25D366/ffffff?text=Buzo", talles: ["S", "M", "L"] },
    { id: 8, nombre: "Licuadora 600W", precio: 12500, categoria: "electro", imagen: "https://via.placeholder.com/300x200/25D366/ffffff?text=Licuadora", garantia: "12 meses" },
    { id: 9, nombre: "Tostadora 2 Ranuras", precio: 6800, categoria: "electro", imagen: "https://via.placeholder.com/300x200/25D366/ffffff?text=Tostadora", garantia: "6 meses" },
    { id: 10, nombre: "Ventilador de Pie", precio: 8900, categoria: "electro", imagen: "https://via.placeholder.com/300x200/25D366/ffffff?text=Ventilador", garantia: "12 meses" },
    { id: 11, nombre: "Cuaderno Universitario", precio: 350, categoria: "libreria", imagen: "https://via.placeholder.com/300x200/25D366/ffffff?text=Cuaderno" },
    { id: 12, nombre: "L√°pices de Colores x12", precio: 180, categoria: "libreria", imagen: "https://via.placeholder.com/300x200/25D366/ffffff?text=Lapices" },
    { id: 13, nombre: "Mochila Escolar", precio: 4200, categoria: "libreria", imagen: "https://via.placeholder.com/300x200/25D366/ffffff?text=Mochila", destacado: true }
  ];

  // Cargar productos desde localStorage o usar datos por defecto
  let productos = cargarDesdeLocalStorage(STORAGE_KEYS.PRODUCTOS) || PRODUCTOS_POR_DEFECTO;

  // Elementos del DOM
  const elementos = {
    busqueda: document.getElementById('busqueda'),
    filtros: document.querySelectorAll('.btn-filtro'),
    btnAdmin: document.getElementById('btnAdmin'),
    bannerOferta: document.getElementById('banner-oferta'),
    bannerRifasContainer: document.getElementById('banner-rifas-container'),
    bannerRifasImg: document.getElementById('banner-rifas-img'),
    bannerRifasTitulo: document.getElementById('banner-rifas-titulo'),
    bannerRifasDescripcion: document.getElementById('banner-rifas-descripcion'),
    footerInfo: document.getElementById('footer-info'),
    footerContacto: document.getElementById('footer-contacto')
  };

  // Inicializaci√≥n de la tienda
  function inicializarTienda() {
    console.log('üõçÔ∏è PuntoAlmacen - Sistema inicializado');
    
    // Cargar elementos de la tienda
    cargarBannerOfertaPersonalizado();
    cargarBannerRifasPersonalizado();
    cargarConfiguracionTienda();
    cargarProductos();
    inicializarEventosTienda();
    
    // Sincronizaci√≥n inicial con admin
    setTimeout(() => {
      sincronizarConAdmin();
    }, 500);
  }

  // Funci√≥n para cargar desde localStorage
  function cargarDesdeLocalStorage(clave) {
    try {
      const datos = localStorage.getItem(clave);
      return datos ? JSON.parse(datos) : null;
    } catch (error) {
      console.error(`‚ùå Error al cargar ${clave}:`, error);
      return null;
    }
  }

  // Cargar banner de oferta personalizado
  function cargarBannerOfertaPersonalizado() {
    const bannerData = cargarDesdeLocalStorage(STORAGE_KEYS.BANNER_OFERTA);
    
    if (bannerData && bannerData.imagen) {
      elementos.bannerOferta.src = bannerData.imagen;
      console.log('‚úÖ Banner de oferta personalizado cargado desde admin');
    }
  }

  // Cargar banner de rifas personalizado
  function cargarBannerRifasPersonalizado() {
    const bannerData = cargarDesdeLocalStorage(STORAGE_KEYS.BANNER_RIFAS);
    
    if (bannerData && bannerData.imagen) {
      elementos.bannerRifasImg.src = bannerData.imagen;
      elementos.bannerRifasContainer.style.display = 'block';
      
      if (bannerData.titulo) {
        elementos.bannerRifasTitulo.textContent = bannerData.titulo;
      }
      if (bannerData.descripcion) {
        elementos.bannerRifasDescripcion.textContent = bannerData.descripcion;
      }
    }
  }

  // Cargar configuraci√≥n de la tienda
  function cargarConfiguracionTienda() {
    const config = cargarDesdeLocalStorage(STORAGE_KEYS.CONFIG);
    
    if (config) {
      if (config.whatsapp) {
        actualizarContactoWhatsApp(config.whatsapp);
      }
      if (config.nombre) {
        document.querySelector('.logo-text').textContent = config.nombre;
      }
      if (config.horarios) {
        elementos.footerInfo.textContent = `¬© 2025 PuntoAlmacen ‚Äì Horarios: ${config.horarios}`;
      }
      if (config.direccion) {
        elementos.footerContacto.innerHTML = `üìç ${config.direccion} ‚Äì <a href="https://wa.me/${config.whatsapp}">WhatsApp: ${config.whatsapp}</a>`;
      }
    }
  }

  // Actualizar contacto de WhatsApp
  function actualizarContactoWhatsApp(telefono) {
    const enlacesWhatsApp = document.querySelectorAll('a[href*="wa.me"]');
    
    enlacesWhatsApp.forEach(enlace => {
      const hrefActual = enlace.href;
      const nuevoHref = hrefActual.replace(/wa\.me\/\d+/, `wa.me/${telefono}`);
      enlace.href = nuevoHref;
    });
  }

  // Cargar productos en las secciones
  function cargarProductos() {
    const secciones = {
      almacen: document.getElementById('almacen'),
      indumentaria: document.getElementById('indumentaria'),
      electro: document.getElementById('electro'),
      libreria: document.getElementById('libreria')
    };

    // Limpiar secciones
    Object.values(secciones).forEach(seccion => {
      if (seccion) seccion.innerHTML = '';
    });

    // Filtrar productos seg√∫n b√∫squeda
    const terminoBusqueda = elementos.busqueda.value.toLowerCase();
    let productosFiltrados = productos;
    
    if (terminoBusqueda) {
      productosFiltrados = productos.filter(producto => 
        producto.nombre.toLowerCase().includes(terminoBusqueda)
      );
    }

    // Filtrar por categor√≠a activa
    const categoriaActiva = document.querySelector('.btn-filtro.active')?.dataset.categoria;
    if (categoriaActiva && categoriaActiva !== 'todos') {
      productosFiltrados = productosFiltrados.filter(producto => 
        producto.categoria === categoriaActiva
      );
    }

    // Mostrar u ocultar secciones seg√∫n filtros
    document.querySelectorAll('.titulo-seccion').forEach(titulo => {
      titulo.style.display = 'none';
    });
    
    document.querySelectorAll('.grilla').forEach(grilla => {
      grilla.style.display = 'none';
    });

    // Agregar productos a las secciones
    productosFiltrados.forEach(producto => {
      const seccion = secciones[producto.categoria];
      if (seccion) {
        seccion.style.display = 'grid';
        seccion.previousElementSibling.style.display = 'block';
        
        const productoElement = document.createElement('div');
        productoElement.className = 'producto-card';
        productoElement.innerHTML = `
          <div class="producto-imagen">
            <img src="${producto.imagen}" alt="${producto.nombre}" 
                 onerror="this.src='https://via.placeholder.com/300x200/25D366/ffffff?text=Producto'">
            ${producto.destacado ? '<span class="badge-oferta">üî• OFERTA</span>' : ''}
          </div>
          <h3>${producto.nombre}</h3>
          ${producto.talles ? `<p><small>Talles: ${producto.talles.join(', ')}</small></p>` : ''}
          ${producto.garantia ? `<p><small>üõ°Ô∏è Garant√≠a: ${producto.garantia}</small></p>` : ''}
          <div class="precio">$${producto.precio}</div>
          <button class="btn-agregar" data-id="${producto.id}">
            üõí Agregar al carrito
          </button>
        `;
        seccion.appendChild(productoElement);
      }
    });

    // Si no hay productos, mostrar mensaje
    if (productosFiltrados.length === 0) {
      const mensaje = document.createElement('div');
      mensaje.className = 'sin-productos';
      mensaje.innerHTML = `
        <h3>üòî No se encontraron productos</h3>
        <p>Intenta con otros t√©rminos de b√∫squeda o cambia de categor√≠a</p>
        <button class="btn-agregar" onclick="limpiarBusqueda()" style="margin-top: 15px; max-width: 200px;">Limpiar b√∫squeda</button>
      `;
      document.querySelector('.container').appendChild(mensaje);
    }

    // Agregar eventos a los botones de agregar al carrito
    document.querySelectorAll('.btn-agregar').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const idProducto = parseInt(e.target.dataset.id);
        const producto = productos.find(p => p.id === idProducto);
        if (producto) {
          cart.agregarProducto(producto);
        }
      });
    });
  }

  // Limpiar b√∫squeda
  function limpiarBusqueda() {
    elementos.busqueda.value = '';
    elementos.filtros.forEach(f => f.classList.remove('active'));
    const filtroTodos = document.querySelector('.btn-filtro[data-categoria="todos"]');
    if (filtroTodos) filtroTodos.classList.add('active');
    cargarProductos();
  }

  // Inicializar eventos de la tienda
  function inicializarEventosTienda() {
    // B√∫squeda
    if (elementos.busqueda) {
      elementos.busqueda.addEventListener('input', cargarProductos);
    }

    // Filtros
    if (elementos.filtros) {
      elementos.filtros.forEach(filtro => {
        filtro.addEventListener('click', () => {
          elementos.filtros.forEach(f => f.classList.remove('active'));
          filtro.classList.add('active');
          cargarProductos();
        });
      });
    }

    // Bot√≥n Admin
    if (elementos.btnAdmin) {
      elementos.btnAdmin.addEventListener('click', () => {
        window.location.href = 'admin.html';
      });
    }
  }

  // Sincronizar con admin
  function sincronizarConAdmin() {
    const productosAdmin = cargarDesdeLocalStorage(STORAGE_KEYS.PRODUCTOS);
    if (productosAdmin && JSON.stringify(productos) !== JSON.stringify(productosAdmin)) {
      productos = productosAdmin;
      cargarProductos();
    }

    cargarBannerOfertaPersonalizado();
    cargarBannerRifasPersonalizado();
    cargarConfiguracionTienda();
    
    // Actualizar configuraci√≥n de env√≠o en el carrito
    cart.cargarConfiguracionEnvio();
    cart.actualizarUI();
  }

  // Inicializar la tienda cuando el DOM est√© listo
  document.addEventListener('DOMContentLoaded', inicializarTienda);

  // Escuchar cambios en localStorage desde otras pesta√±as
  window.addEventListener('storage', function(e) {
    if (Object.values(STORAGE_KEYS).includes(e.key)) {
      sincronizarConAdmin();
    }
  });

</script>
</body>
</html>